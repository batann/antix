#!/bin/bash

# Function to display an error message and exit
error_exit() {
  echo -e >&2 "${Red}Error: $1${NC}"
  exit 1
}

# Function to execute commands in tmux pane-1 and keep script running
tmux_run_and_wait() {
  if ! tmux send-keys -t 1 "$1" Enter; then
    error_exit "Failed to send command to tmux pane-1: $1"
  fi
  # Wait for command to finish before next prompt
  sleep 5
}

#############################################################
# ANSI code and date variables
Black='\033[0;30m'
Red='\033[0;31m'
Green='\033[0;32m'
Blue='\033[0;34m'
Purple='\033[0;35m'
Cyan='\033[0;36m'
Yellow='\033[1;33m'
White='\033[1;37m'
NC='\033[0m'
ddd=$(date +%j)

clear

echo -e "${Cyan}<<<'${Purple}----------------------------------------------'${Cyan}'>>>'${Yellow}"
echo -e "${Cyan}     <<<'${Purple}=========================='${Cyan}'>>>"
echo -e '       Setting LAMP Server Up...'
echo -e "${Cyan}     <<<'${Purple}=========================='${Cyan}'>>>"
echo -e "${Cyan}<<<'${Purple}----------------------------------------------'${Cyan}'>>>'${Yellow}"
clear
echo -e ${Cyan}'<<<'${Purple}'----------------------------------------------'${Cyan}'>>>'${Yellow}
echo -e ${Cyan}'         <<<'${Purple}'=========================='${Cyan}'>>>'
echo -e '             Setting LAMP Server Up...'
echo -e ${Cyan}'         <<<'${Purple}'=========================='${Cyan}'>>>'
echo -e ${Cyan}'<<<'${Purple}'----------------------------------------------'${Cyan}'>>>'${Yellow}



echo -e ${Red}'      >>> '${Blue}'1'${Green}')'${Yellow}' Install apache2'
echo -e ${Red}'      >>> '${Blue}'2'${Green}')'${Yellow}' Start Stop & Enable at Boot'
echo -e ${Red}'      >>> '${Blue}'3'${Green}')'${Yellow}' Allow 80 & 433'
echo -e ${Red}'      >>> '${Blue}'4'${Green}')'${Yellow}' Install PhP & enable mod'
echo -e ${Red}'      >>> '${Blue}'5'${Green}')'${Yellow}' ICE mariadb-server'
echo -e ${Red}'      >>> '${Blue}'6'${Green}')'${Yellow}' Mysql_secure_Install'
echo -e ${Red}'      >>> '${Blue}'7'${Green}')'${Yellow}' Set Password Mariadb'
echo -e ${Red}'      >>> '${Blue}'8'${Green}')'${Yellow}' Install PhPMyAdmin'
echo -e ${Red}'      >>> '${Blue}'9'${Green}')'${Yellow}' XXXXXXXX'
#echo -e ${Red}'>>> '${Blue}'10'${Green}')'${Yellow}' XXXXXXXX'
#echo -e ${Red}'>>> '${Blue}'11'${Green}')'${Yellow}' XXXXXXXX'
#echo -e ${Red}'>>> '${Blue}'12'${Green}')'${Yellow}' XXXXXXXX'
#echo -e ${Red}'>>> '${Blue}'13'${Green}')'${Yellow}' XXXXXXXX'
#echo -e ${Red}'>>> '${Blue}'14'${Green}')'${Yellow}' XXXXXXXX'
echo -e ${Cyan}'<<<'${Purple}'----------------------------------------------'${Cyan}'>>>'${Yellow}


options=("1" "2" "3" "4" "5" "6" "7" "8" "9")

while true; do
  read -p '   >>> ' inputone

  case $inputone in
    1)
      tmux_run_and_wait "sudo apt install apache2" ;;
    2)
      tmux_run_and_wait "sudo service apache2 start && sudo service apache2 stop && sudo update-rc.d apache2 defaults" ;;
    3)
      tmux_run_and_wait "sudo ufw allow 80 && sudo ufw allow 443 && sudo ufw reload" ;;
    4)
      tmux_run_and_wait "sudo apt install php php-mysql"
      tmux_run_and_wait "sudo a2enmod php7.4" # Replace with relevant mod based on your PHP version
      ;;
    5)
      tmux_run_and_wait "sudo apt install mariadb-server" ;;
    6)
      tmux_run_and_wait "sudo mysql_secure_installation" ;;
      # Use a secure password and adjust other security settings as needed
      
    7)
      echo -e "${Yellow}Enter desired password for MySQL root user:${NC}"
      read -s password
      tmux_run_and_wait "sudo mysql -u root -p -e 'SET PASSWORD FOR root@localhost = PASSWORD(\"$password\");'"
      ;;
    8)
      tmux_run_and_wait "sudo apt install phpmyadmin"
      # Configure phpMyAdmin according to your needs
      ;;
    9)
      echo -e "${Red}Option 9 is not implemented yet.${NC}" ;;
    *)
      echo -e "${Red}Invalid option: $inputone${NC}" ;;
  esac

  echo -e "\nCommand executed. Press any key to continue or 'q' to quit."
  read -n 1 -r key
  if [[ $key == "q" || $key == "Q" ]]; then
    break
  fi
done

echo -e "\nLAMP server setup incomplete. Manual steps may be required."
echo -e "Remember to configure security settings, databases, and other aspects."


